version: '2'

services:
  mongo:
    image: mongo
    volumes:
      - ${PWD}/_data/mongo:/data/db
    expose:
      - 27017

  ingress-router:
    build: ./nginx
    volumes:
      - ${PWD}/nginx/conf/nginx.conf:/etc/nginx/nginx.conf
      - ${PWD}/_data/strider:/home/strider/.strider
    ports:
      - 8888:80

  strider:
    # image: dev/strider
    build: .
    env_file: ./.env
    environment:
      VIRTUAL_HOST: 'strider.dev'
      DB_URI: 'mongodb://mongo:27017/strider-testing'
      NODE_ENV: production
      SERVER_NAME: 'http://strider.dev:8888'
      DEBUG: 'strider*'